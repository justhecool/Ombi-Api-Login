//JWT Decode
!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){function d(a){this.message=a}function e(a){var b=String(a).replace(/=+$/,"");if(b.length%4==1)throw new d("'atob' failed: The string to be decoded is not correctly encoded.");for(var c,e,g=0,h=0,i="";e=b.charAt(h++);~e&&(c=g%4?64*c+e:e,g++%4)?i+=String.fromCharCode(255&c>>(-2*g&6)):0)e=f.indexOf(e);return i}var f="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";d.prototype=new Error,d.prototype.name="InvalidCharacterError",b.exports="undefined"!=typeof window&&window.atob&&window.atob.bind(window)||e},{}],2:[function(a,b,c){function d(a){return decodeURIComponent(e(a).replace(/(.)/g,function(a,b){var c=b.charCodeAt(0).toString(16).toUpperCase();return c.length<2&&(c="0"+c),"%"+c}))}var e=a("./atob");b.exports=function(a){var b=a.replace(/-/g,"+").replace(/_/g,"/");switch(b.length%4){case 0:break;case 2:b+="==";break;case 3:b+="=";break;default:throw"Illegal base64url string!"}try{return d(b)}catch(c){return e(b)}}},{"./atob":1}],3:[function(a,b,c){"use strict";function d(a){this.message=a}var e=a("./base64_url_decode");d.prototype=new Error,d.prototype.name="InvalidTokenError",b.exports=function(a,b){if("string"!=typeof a)throw new d("Invalid token specified");b=b||{};var c=b.header===!0?0:1;try{return JSON.parse(e(a.split(".")[c]))}catch(f){throw new d("Invalid token specified: "+f.message)}},b.exports.InvalidTokenError=d},{"./base64_url_decode":2}],4:[function(a,b,c){(function(b){var c=a("./lib/index");"function"==typeof b.window.define&&b.window.define.amd?b.window.define("jwt_decode",function(){return c}):b.window&&(b.window.jwt_decode=c)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./lib/index":3}]},{},[4]);
//Api
function login()
{$('.active').show();$.ajax({type:"POST",data:$('#appLogin').serialize(),dataType:'json',timeout:5000,cache:false,async: true,success:function(data){console.log(data);if(data.success==true){$('.active').hide();var api_key=data.token;localStorage.setItem('id_token',api_key);$(window).attr('location',data.url);}
if(data.g_auth==true){$('.mini.modal').modal({blurring:true,closable:false,onDeny:function(){$('#password').val('');$('.active').hide();},onApprove:function(){login();$('.active').hide();}}).modal('show');}
if(data.success==false){$('.active').hide();UIkit.notification({message:'<span uk-icon=\'icon: warning\'></span> '+data.msg,pos:'top-center',status:'danger'});}
if(data.code==false){$('.mini.modal').modal({blurring:true,closable:false,onDeny:function(){$('#prov').val('');$('#mfacode').val('');$('.active').hide();},onApprove:function(){$('#prov').val('totp');login();$('.mini.modal').modal('close');}}).modal('show');UIkit.notification({message:'<span uk-icon=\'icon: warning\'></span> '+data.msg,pos:'bottom-left',status:'danger'});}},error:function(xhr,status,error){$('.active').hide();UIkit.notification({message:'<span uk-icon=\'icon: warning\'></span> Request Timeout, Try again',pos:'top-center',status:'danger'});console.log(xhr);$('#result').append(xhr.responseText);}});}
$(document).ready(function(){$("#appRegister").validate({rules:{remail:{required:true,email:true,remote:"check.php",},rusername:{required:true,minlength:3,remote:"check.php"},pwd:{required:true,minlength:6}},messages:{rusername:{minlength:"Username should be at least 3 characters",remote:jQuery.validator.format("{0} is already in use!")},remail:{email:"The email should be in the format: abc@domain.com",remote:jQuery.validator.format("{0} is already in use!")},pwd:{minlength:"Passwords should be at least 6 characters"}},errorElement:'label'});});$('#appRegister').submit(function(event){event.preventDefault();if($('#appRegister').valid()){$('.active').show();$.ajax({type:"POST",data:$('#appRegister').serialize(),dataType:'json',success:function(data){console.log(data);if(data.success==true){$('.active').hide();$(window).attr('location',data.url+permalink);}
if(data.g_auth==true){$('.active').hide();openMfa();$('#prov').val('totp');}
if(data.code==false){$('.code').append(data.message).slideDown("slow");setTimeout(function(){$('.code').slideUp();$('.code').empty();},5000);}
if(data.success==false){$('.active').hide();UIkit.notification({message:'<span uk-icon=\'icon: warning\'></span> '+data.msg,pos:'bottom-left',status:'danger'});}}});}});function isEmpty(obj){for(var key in obj){if(obj.hasOwnProperty(key))
return false;}
return true;}
function forgot(){$('.active').show();$.ajax({type:"POST",data:$('#appForgot').serialize(),dataType:'json',success:function(data){console.log(data);if(data.success==true){$('.active').hide();UIkit.notification({message:'<span uk-icon=\'icon: check\'></span> '+data.msg,pos:'bottom-left',status:'success'});$('.login-box').show();$('.register-box').hide();$('.forgot-box').hide();}
if(data.success==false){$('.active').hide();UIkit.notification({message:'<span uk-icon=\'icon: warning\'></span> '+data.msg,pos:'bottom-left',status:'danger'});}},error:function(xhr,status,error){console.log(xhr);$('#result').append(xhr.responseText);}});}
$(document).on("click",".join",function(){$('.login-box').hide();$('.join-box').show();$('.forgot-box').hide();});$(document).on("click",".login",function(){$('.login-box').show();$('.join-box').hide();$('.forgot-box').hide();});$(document).on("click",".forgot",function(){$('.login-box').hide();$('.join-box').hide();$('.forgot-box').show();});$("#appLogin").submit(function(e){e.preventDefault();});$('#password-j').change(function(){$('#password').val($(this).val());});function terms(){$('.terms.modal').modal({blurring:true}).modal('show');}
$(document).ready(function(){$("#appJoin").validate({rules:{remail:{required:true,email:true},rusername:{required:true,minlength:2}},messages:{rusername:{minlength:"Names should be at least 2 characters"},remail:{email:"The email should be in the format: abc@domain.com"}},errorElement:'label'});});$('#appJoin').submit(function(event){event.preventDefault();if($('#appJoin').valid()){$('.active').show();$.ajax({type:"POST",data:$('#appJoin').serialize(),dataType:'json',success:function(data){console.log(data);if(data.success==true){msg();$('.active').hide();}
if(data.success==false){$('.active').hide();UIkit.notification({message:'<span uk-icon=\'icon: warning\'></span> '+data.msg,pos:'bottom-left',status:'danger'});}}});}});function msg(){$('.success-msg.modal').modal({blurring:true,closable:false}).modal('show');}function info(){$('.info-panel.modal').modal({blurring:true,closable:true}).modal('show');}$(document).on("click",".info",function(){info();});const base_url=window.location.origin;$(function(){bg();//UIkit.notification({message: '<span uk-icon=\'icon: info\'></span> This site is currently going through maintenance. Sorry for the inconvenince!', pos: 'top-left', status:'warning', timeout: 0});
});function bg()
{var backgrounds=base_url+'/requests/api/v1/Images/background/';fetch(backgrounds).then((resp)=>resp.json()).then(function(data){$('body').css('background-image','linear-gradient(-10deg, transparent 20%, rgba(0,0,0,0.7) 20.0%, rgba(0,0,0,0.7) 80.0%, transparent 80%), url('+data.url+')');});}
setInterval(bg,25000);const token=localStorage.getItem('id_token');if(token!=null){const decode=jwt_decode(token);if(isAuthenticated(decode)==true){if(decode.role=="Admin"){$(window).attr('location',base_url+'/admin/');}
else{$(window).attr('location',base_url+'/requests/discover');}}
else{localStorage.clear();}}
function isAuthenticated(decode){try{const{exp}=decode.exp;if(Date.now()>=exp*1000){return false;}}catch(err){return false;}
return true;}